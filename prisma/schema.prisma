generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  TOURIST
  GUIDE
  ADMIN
}

enum UserStatus {
  ACTIVE
  BLOCKED
  DELETED
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum AuthProvider {
  GOOGLE
  FACEBOOK
  GITHUB
}

model Auth {
  id         String       @id @default(uuid())
  provider   AuthProvider
  providerId String

  userId String
  user   User   @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())

  @@unique([provider, providerId])
}

model User {
  id       String   @id @default(uuid())
  email    String   @unique
  password String
  role     UserRole

  needPasswordChange Boolean    @default(true)
  status             UserStatus @default(ACTIVE)

  auths Auth[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tourist Tourist?
  guide   Guide?
  admin   Admin?

  @@map("users")
}

model Tourist {
  id String @id @default(uuid())

  userId String @unique

  name          String
  gender        Gender
  profilePhoto  String?
  bio           String?
  address       String?
  contactNumber String?
  languages     String[]
  preferences   String?

  user User @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  bookings  Booking[]
  reviews   Review[]
  wishlists Wishlist[]

  @@map("tourists")
}

model Guide {
  id String @id @default(uuid())

  userId String @unique

  name          String
  gender        Gender
  profilePhoto  String?
  bio           String?
  address       String?
  contactNumber String?
  languages     String[]
  expertise     String[]
  dailyRate     Int

  isVerified Boolean @default(false)

  otp          String?
  otpExpiresAt DateTime?

  user User @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  listings Tour[]
  bookings Booking[]
  reviews  Review[]

  @@map("guides")
}

model Admin {
  id String @id @default(uuid())

  userId String @unique

  name          String
  profilePhoto  String?
  address       String?
  contactNumber String?
  isSuper       Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id])

  @@map("admins")
}

// -----------
enum TourCategory {
  FOOD
  ART
  ADVENTURE
  HISTORY
  NATURE
  SHOPPING
  PHOTOGRAPHY
  NIGHTLIFE
  CULTURE
  SPORTS
}

model Tour {
  id           String       @id @default(uuid())
  guideId      String
  title        String
  description  String
  itinerary    String
  price        Int // tour fee in local currency
  duration     Int // in hours
  durationType String?      @default("hours") // "hours" or "days"
  meetingPoint String
  maxGroupSize Int
  category     TourCategory
  city         String // for search/filter
  country      String? // optional
  images       String[]

  isActive   Boolean @default(true)
  isFeatured Boolean @default(false)

  guide    Guide     @relation(fields: [guideId], references: [id])
  bookings Booking[]
  reviews  Review[]

  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  wishlists Wishlist[]

  @@index([city])
  @@index([category])
  @@index([guideId])
  @@index([isActive])
  @@index([price])
  @@map("tours")
}

enum BookingStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
}

model Booking {
  id        String @id @default(uuid())
  touristId String
  guideId   String
  tourId    String

  date           DateTime
  status         BookingStatus @default(PENDING)
  numberOfPeople Int           @default(1)
  totalAmount    Int // price * numberOfPeople

  // Payment fields
  isPaid        Boolean       @default(false)
  paymentStatus PaymentStatus @default(PENDING)
  paymentId     String? // reference from payment gateway
  paidAt        DateTime?

  guidePayoutAmount Int?
  isGuidePaid       Boolean @default(false)

  tourist Tourist @relation(fields: [touristId], references: [id])
  guide   Guide   @relation(fields: [guideId], references: [id])
  tour    Tour    @relation(fields: [tourId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  review  Review?
  payment Payment?

  @@index([touristId])
  @@index([guideId])
  @@index([status])
  @@index([date])
  @@map("bookings")
}

model Review {
  id      String  @id @default(uuid())
  rating  Int // Should be 1-5
  comment String?

  bookingId String @unique
  touristId String
  guideId   String
  tourId    String

  booking Booking @relation(fields: [bookingId], references: [id])
  tourist Tourist @relation(fields: [touristId], references: [id])
  guide   Guide   @relation(fields: [guideId], references: [id])
  tour    Tour    @relation(fields: [tourId], references: [id])

  createdAt DateTime @default(now())

  @@map("reviews")
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

model Payment {
  id            String        @id @default(uuid())
  bookingId     String        @unique
  amount        Int
  currency      String        @default("USD")
  status        PaymentStatus @default(PENDING)
  paymentMethod String? // "stripe", "sslcommerz", etc.
  transactionId String?
  metadata      Json? // raw response from payment gateway

  booking Booking @relation(fields: [bookingId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("payments")
}

model Wishlist {
  id        String @id @default(uuid())
  touristId String
  tourId    String

  tourist Tourist @relation(fields: [touristId], references: [id])
  tour    Tour    @relation(fields: [tourId], references: [id])

  createdAt DateTime @default(now())

  @@unique([touristId, tourId])
  @@map("wishlists")
}
